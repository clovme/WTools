/*! (c) Ashampoo GmbH & Co. KG */
var _dialogLogfilePrefix="[LICENSE SERIAL]: ",bantshee=new bantshee,gBantData;gBantData=bant.resources.get("licenses|images"),document.getElementById("boxshot").src=gBantData.images.boxshot,bant.callback.dialog.onShow=function(){bantshee.currentDialog="license.serial.html",bantshee.navigate.setDataTargets()},$(document).ready(function(){function e(){var e=$.trim(document.getElementById("serial").value.toUpperCase()),t="serial-idle";bantshee.utils.isSerialKey(e)?(t="serial-ok",$("#status-trial button").removeAttr("disabled"),$("#status-trial .cta-button").show()):($("#status-trial button").attr("disabled","disabled"),$("#status-trial .cta-button").hide(),e.length>5&&(t="serial-wrong")),$("#status-trial ash-input").attr("class",t)}var t=bant.resources.get("licenses"),a=t.licenses.main,i=(a.is_expired,a.is_extended),n=(a.is_purchased,a.is_activated),o=a.key;if($("#status-trial .cta-button").hide(),e(),bant.callback.clipboard.onLicenseKey=function(t){$("#status-trial input").val(t),e()},document.addEventListener?$("#serial").on("input",e):$("#serial").on("keyup input",e),$("#status-trial form").submit(function(e){if(e.preventDefault(),!$("#status-trial button").attr("disabled"))if(n)bant.log.info(_dialogLogfilePrefix+"Programm already running as purchased/full version. Closing Dialog."),bant.dialog.close(this,"ok");else{var t=document.getElementById("serial").value.toUpperCase();if(""==$.trim(t))return;var o=$.trim(t);if(bant.log.info(_dialogLogfilePrefix+"Setting bantLicense.key to Key entered by user ..."),a.key=o,a.key!=o){bant.log.warning(_dialogLogfilePrefix+"Key in license variable could not be swapped.");var s=bant.session.getPrimaryLicense();bant.log.info(_dialogLogfilePrefix+"Trying to delete key from registry ..."),s.reset(),s.key?bant.log.error(_dialogLogfilePrefix+"Key could not be removed. Oh well, this ain't gonna be pretty."):bant.log.info(_dialogLogfilePrefix+"Key deleted."),bant.log.info(_dialogLogfilePrefix+"Trying to set bantLicense.key to user input ..."),a.key=o,bant.log.info(_dialogLogfilePrefix+"Key entered by user is "+o),bant.log.info(_dialogLogfilePrefix+"bantLicense.key is now "+a.key)}if(bant.log.info(_dialogLogfilePrefix+"trying "+a.key),bant.license.isValid(a)){var l=bant.license.update(a);return l.key&&""!=l.key||bant.log.info(_dialogLogfilePrefix+"There is no key, only Zuul."),bant.log.debug(JSON.stringify(l,null,4)),0!=l.error.code?(bant.log.error(_dialogLogfilePrefix+"Got error code ("+l.error.code+") ... investigating further."),bant.log.info(_dialogLogfilePrefix+"error "+l.error.code),bant.log.info(JSON.stringify(l,null,4)),"-2"==l.error.code?(bant.log.error(_dialogLogfilePrefix+"User probably offline; Key could not be validated."),void bantshee.navigate.toStatus("status-license-offline")):157==l.error.code||160==l.error.code||170==l.error.code?(bant.log.error(_dialogLogfilePrefix+"Error "+l.error.code),void bantshee.navigate.toStatus("status-"+l.error.code)):2==l.error.code?(bant.log.info(_dialogLogfilePrefix+"Same key entered twice / already entered."),bant.log.info(_dialogLogfilePrefix+"HERE. WE. ARE."),void bantshee.navigate.toStatus("status-2")):(bant.log.error(_dialogLogfilePrefix+"Error not specified. Probably wrong key or no key found in license."),void bantshee.navigate.toStatus("status-undefined"))):l.is_activated?(bant.log.info(_dialogLogfilePrefix+"Activated. Thank you."),void bantshee.navigate.toStatus("status-thx")):l.is_extended?i?(bant.log.info(_dialogLogfilePrefix+"trialkey entered while already in extended trial period."),void bantshee.navigate.toStatus("status-2")):(bant.log.info(_dialogLogfilePrefix+"Trial phase extended."),void bantshee.navigate.toStatus("status-extended-thx")):(bant.log.info(_dialogLogfilePrefix+"Unknown Status"),bant.log.info(_dialogLogfilePrefix+JSON.stringify(l,null,4)),void bantshee.navigate.toStatus("status-undefined"))}}}),n){var s=bant.resources.get("licenses"),l=s.licenses.main,o=l.key;$("#status-purchased input").val(o),bantshee.navigate.toStatus("status-purchased")}$("#status-undefined *.back button").click(function(e){e.preventDefault(),$("#status-trial input").val(""),bant.log.info(_dialogLogfilePrefix+"status-undefined -> Back Button -> Reloading Dialog to reset everything."),bant.dialog.load("license.serial","dialog.error")}),$("#status-2 *.back button").click(function(e){e.preventDefault(),$("#status-trial input").val(""),bant.log.info(_dialogLogfilePrefix+"status-2 -> Back Button -> Reloading Dialog to reset everything."),bant.dialog.load("license.serial","dialog.error")}),$("#status-license-offline *.back button").click(function(e){e.preventDefault(),bant.log.info(_dialogLogfilePrefix+"status-license-offline -> Back Button -> Reloading Dialog to reset everything."),bant.dialog.load("license.serial","dialog.error")}),$("#status-license-offline *.next button, #status-license-offline a.next").click(function(){$("#status-license-offline-page2 input.serialkey").val(a.key),bantshee.navigate.toStatus("status-license-offline-page2"),bant.dialog.layout()}),$("#status-license-offline-page2 *.back button").click(function(){bantshee.navigate.toStatus("status-license-offline"),bant.dialog.layout()}),$("#status-license-offline-page2 *.cta-button button").click(function(){bant.dialog.close(this,"ok")}),$(".link-delete-key").click(function(){bantshee.navigate.toStatus("status-reset-license-question")}),$("#status-reset-license-question *.back button").click(function(){bantshee.navigate.toStatus("status-license-purchased")}),$("#status-reset-license-question *.back button").click(function(){bantshee.navigate.toStatus("status-purchased")}),$("#status-reset-license-question *.cta-button button").click(function(){var e=bant.session.getPrimaryLicense();bant.log.info(_dialogLogfilePrefix+"Trying to delete key."),e.reset(),e.key?(bant.log.error(_dialogLogfilePrefix+"Key could not be removed."),bantshee.navigate.toStatus("status-reset-license-failed")):(bant.log.info(_dialogLogfilePrefix+"Key deleted."),bantshee.navigate.toStatus("status-reset-license-done"))}),$("#status-reset-license-done *.cta-button button").click(function(){bant.dialog.close(this,"ok")}),$("#status-reset-license-failed *.cta-button button").click(function(){bantshee.navigate.toStatus("status-purchased")})}),bant.log.info(_dialogLogfilePrefix+"loaded.");